<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>Campus Crowd</title>
        <!-- Mobile Device Viewport -->
        <meta name="viewport" content="width=device-width, initial-scale=0.01">
        <!-- External -->
        <link rel="icon" type="image/x-icon" href="/images/uncc.png">
        <link rel="stylesheet" type="text/css" href="/css/main.css">
        <!-- script src="/javascript/script.js"></script -->
        <script type="text/javascript" src="https://maps.googleapis.com/maps/api/js?sensor=false"></script>
        <script src="/javascript/external/heatmap.js"></script>
        <script src="/javascript/external/gmaps-heatmap.js"></script>
    </head>
    <body>
        <header>
            <h3>Campus Crowd</h3>
        </header>
        <main>
            <div id="subBar">
                <button>1 AM</button>
                <button>2 AM</button>
                <button>3 AM</button>
                <button>4 AM</button>
                <button>5 AM</button>
                <button>6 AM</button>
                <button>7 AM</button>
                <button>8 AM</button>
                <button>9 AM</button>
                <button>10 AM</button>
                <button>11 AM</button>
                <button>12 PM</button>
                <button>1 PM</button>
                <button>2 PM</button>
                <button>3 PM</button>
                <button>4 PM</button>
                <button>5 PM</button>
                <button>6 PM</button>
                <button>7 PM</button>
                <button>8 PM</button>
                <button>9 PM</button>
                <button>10 PM</button>
                <button>11 PM</button>
                <button>12 AM</button>
            </div>
            <%
                let str = JSON_weight.substring(1).slice(0, -1);
                const arr = str.split(",");
                let k = []; // locations
                let names = []; // names
                let v = []; // connections
                let lat = []; // latitude
                let lng = []; // longitude
                let reK = /^[^:]+:\s*/g; // regex for chars before colon
                let reV = /:(.*)/g; // regex for chars after colon

                // generate locations and connections
                for (let i=0; i < arr.length; i++){
                    let str = arr[i];
                    let _newK = str.match(reK);
                    let fK = _newK.toString().substring(1).slice(0, -2);
                    k.push(fK);
                    let _newV = str.match(reV);
                    let fV = _newV.toString().substring(1);
                    v.push(fV);
                }

                // fix coordinates to locations
                for (let i=0; i < arr.length; i++) {
                    switch(k[i]) {
                        case "Atki":
                            names.push("Atkins Library");
                            lat.push(35.305746);
                            lng.push(-80.732146);
                            break;
                        case "Duke":
                            names.push("Duke Centennial Hall");
                            lat.push(35.311927);
                            lng.push(-80.741154);
                            break;
                        case "StuU":
                            names.push("Popp Martin Student Union");
                            lat.push(35.308603);
                            lng.push(-80.733723);
                            break;
                        case "AtkiG":
                            names.push("Atkins Library - Ground");
                            lat.push(35.305991);
                            lng.push(-80.732742);
                            break;
                        case "StuUM":
                            names.push("Student Union - Middle");
                            lat.push(35.307846);
                            lng.push(-80.733711);
                            break;
                        case "Kenn":
                            names.push("Kennedy");
                            lat.push(35.305969);
                            lng.push(-80.730933);
                            break;
                        case "Cato":
                            names.push("Cato College of Education");
                            lat.push(35.305434);
                            lng.push(-80.728730);
                            break;
                        case "Scie":
                            names.push("Science Building");
                            lat.push(35.308482);
                            lng.push(-80.730029);
                            break;
                        case "Moto":
                            names.push("Motorsports Research");
                            lat.push(35.312614);
                            lng.push(-80.740266);
                            break;
                        case "AtkiL":
                            names.push("Atkins Library - Lower");
                            lat.push(35.305667);
                            lng.push(-80.731668);
                            break;
                        case "McEn":
                            names.push("McEniry");
                            lat.push(35.307097);
                            lng.push(-80.730157);
                            break;
                        case "EXT":
                            names.push("Bissel House - Exit");
                            lat.push(35.301056);
                            lng.push(-80.738977);
                            break;
                        case "Biss":
                            names.push("Bissel House - Chancellor's Residence");
                            lat.push(35.301056);
                            lng.push(-80.738977);
                            break;
                        case "LibW":
                            names.push("Atkins Library - Walkway");
                            lat.push(35.304879);
                            lng.push(-80.732245);
                            break;
                        case "Rees":
                            names.push("Reese");
                            lat.push(35.3046865);
                            lng.push(-80.7325075);
                            break;
                        case "Fret":
                            names.push("Fretwell");
                            lat.push(35.30609617329542);
                            lng.push(-80.72905836119102);
                            break;
                        case "Scot":
                            names.push("Scott Hall");
                            lat.push(35.301745442516655);
                            lng.push(-80.73536472973072);
                            break;
                        case "HunH":
                            names.push("Hunt Hall");
                            lat.push(35.3014512904921);
                            lng.push(-80.73649720639536);
                            break;
                        case "Foun":
                            names.push("Foundation");
                            lat.push(35.29794910569405);
                            lng.push(-80.73691568215568);
                            break;
                        case "Colv":
                            names.push("Colvard");
                            lat.push(35.3047288);
                            lng.push(-80.7318175);
                            break;
                        case "Gari":
                            names.push("Garinger");
                            lat.push(35.30501426437236);
                            lng.push(-80.73020795332306);
                            break;
                        case "MilH":
                            names.push("Miltmore Hall");
                            lat.push(35.31120445845271);
                            lng.push(-80.73546086850881);
                            break;
                        case "Cone":
                            names.push("Cone University Center");
                            lat.push(35.30539145277517);
                            lng.push(-80.73321607933849);
                            break;
                        case "King":
                            names.push("King");
                            lat.push(35.305075897472854);
                            lng.push(-80.73257741691799);
                            break;
                        case "CoEd":
                            names.push("Cato College of Education");
                            lat.push(35.30759045861732);
                            lng.push(-80.73413267874088);
                            break;
                        case "Levi":
                            names.push("Levine Hall");
                            lat.push(35.302890925010665);
                            lng.push(-80.73313648024713);
                            break;
                        case "Grig":
                            names.push("Grigg Hall");
                            lat.push(35.31128413499671);
                            lng.push(-80.7418437948065);
                            break;
                        case "BelGPool":
                            names.push("Belk Gym Pool");
                            lat.push(35.30533877292375);
                            lng.push(-80.73559950455898);
                            break;
                        case "BursBOIL":
                            names.push("Burson Boiler Building");
                            lat.push(35.30739649766536);
                            lng.push(-80.7323005232744);
                            break;
                        case "Came":
                            names.push("Cameron Hall");
                            lat.push(35.30766893240503);
                            lng.push(-80.73125757789353);
                            break;
                        case "BelH":
                            names.push("Belk Hall");
                            lat.push(35.31020420511571);
                            lng.push(-80.73513844953378);
                            break;
                        case "Stor":
                            names.push("Storrs");
                            lat.push(35.30457871751996);
                            lng.push(-80.72920178915456);
                            break;
                        case "BURS":
                            names.push("Burson");
                            lat.push(35.30739649766536);
                            lng.push(-80.7323005232744);
                            break;
                        case "Smit":
                            names.push("Smith");
                            lat.push(35.30694979430145);
                            lng.push(-80.73154882607298);
                            break;
                        case "Winn":
                            names.push("Winningham");
                            lat.push(35.30510282119657);
                            lng.push(-80.73044941939384);
                            break;
                        case "Faci":
                            names.push("Facilities Management");
                            lat.push(35.312010426369376);
                            lng.push(-80.73049088977476);
                            break;
                        case "EPIC":
                            names.push("EPIC");
                            lat.push(35.31189811943846);
                            lng.push(-80.74119004392253);
                            break;
                        case "PORT":
                            names.push("PORTAL");
                            lat.push(35.311692789354176);
                            lng.push(-80.74298916559158);
                            break;
                        case "MSII":
                            names.push("Military Science");
                            lat.push(35.303758090594165);
                            lng.push(-80.73590696050901);
                            break;
                        case "Tenn":
                            names.push("Halton-Wagner Tennis Complex");
                            lat.push(35.307403467038604);
                            lng.push(-80.73740777078115);
                            break;
                        case "BaTF":
                            names.push("Transamerica Field - Baseball");
                            lat.push(35.30811487469631);
                            lng.push(-80.73903712726472);
                            break;
                        case "StuH":
                            names.push("Student Health Center");
                            lat.push(35.3105524918975);
                            lng.push(-80.72958746698107);
                            break;
                        case "CenC":
                            names.push("Center City Building");
                            lat.push(35.22837561149495);
                            lng.push(-80.83494731884977);
                            break;
                        case "Bioi":
                            names.push("Bioinformatics");
                            lat.push(35.3125545);
                            lng.push(-80.741512);
                            break;
                        case "Auxi":
                            names.push("Auxiliary Services Building");
                            lat.push(35.30766993673688);
                            lng.push(-80.73048107918797);
                            break;
                        case "Pros":
                            names.push("Prospector");
                            lat.push(35.306545047508436);
                            lng.push(-80.73089474281956);
                            break;
                        case "Wach":
                            names.push("Wachovia Lot");
                            lat.push(35.30674961000998);
                            lng.push(-80.73789627786617);
                            break;
                        case "RUP":
                            names.push("Regional Utility Plant");
                            lat.push(35.30034922462913);
                            lng.push(-80.73550624762174);
                            break;
                        case "Rece":
                            names.push("Receiving & Stores");
                            lat.push(35.31429031164012);
                            lng.push(-80.73383991982728);
                            break;
                        case "Hick":
                            names.push("Hickory Hall");
                            lat.push(35.30920918659618);
                            lng.push(-80.72900305289947);
                            break;
                        case "EPICG":
                            names.push("EPIC - Ground");
                            lat.push(35.30893850523969);
                            lng.push(-80.74144019949817);
                            break;
                        case "MiltA":
                            names.push("Miltmore Hall");
                            lat.push(35.311110707418734);
                            lng.push(-80.73541348525717);
                            break;
                        case "Wood":
                            names.push("Woodward");
                            lat.push(35.30714938477803);
                            lng.push(-80.73571149971485);
                            break;
                        case "Irwi":
                            names.push("Irwin Belk Track & Field");
                            lat.push(35.3055340318995);
                            lng.push(-80.73760639279563);
                            break;
                        case "Heal":
                            names.push("College of Health & Human Services");
                            lat.push(35.30740406450089);
                            lng.push(-80.73336972100714);
                            break;
                        case "Syca":
                            names.push("Sycamore Hall");
                            lat.push(35.308845791469416);
                            lng.push(-80.72899591410679);
                            break;
                        case "BelG":
                            names.push("Belk Gym");
                            lat.push(35.30536214924615);
                            lng.push(-80.73561251662721);
                            break;
                        case "Wall":
                            names.push("Wallis Hall");
                            lat.push(35.31147075717193);
                            lng.push(-80.73396322431611);
                            break;
                        case "Harr":
                            names.push("Harris Alumni Center");
                            lat.push(35.30273474608917);
                            lng.push(-80.73870538593044);
                            break;
                        case "Robi":
                            names.push("Robinson Hall");
                            lat.push(35.30375735741013);
                            lng.push(-80.72992203994481);
                            break;
                        case "Rowe":
                            names.push("Rowe");
                            lat.push(35.30444513210468);
                            lng.push(-80.7308401321233);
                            break;
                        case "Lync":
                            names.push("Lynch Hall");
                            lat.push(35.310200558605175);
                            lng.push(-80.73371371440811);
                            break;
                        case "Memo":
                            names.push("Memorial Hall");
                            lat.push(35.30373048465129);
                            lng.push(-80.73589463996213);
                            break;
                        case "UREC":
                            names.push("University Recreation Center");
                            lat.push(35.30831292797602);
                            lng.push(-80.73541667969782);
                            break;
                        case "StuA":
                            names.push("Student Activity Center");
                            lat.push(35.30625938227615);
                            lng.push(-80.73445998972124);
                            break;
                        case "Gage":
                            names.push("Gage Undergraduate Admissions");
                            lat.push(35.30111581484298);
                            lng.push(-80.733002577923);
                            break;
                        case "Hous":
                            names.push("Housing & Resident Life");
                            lat.push(35.30211038685805);
                            lng.push(-80.73360840569094);
                            break;
                        case "SVDH":
                            names.push("South Village Dining Hall - SoVi");
                            lat.push(35.302832777094864);
                            lng.push(-80.7349231756767);
                            break;
                        case "SoTF":
                            names.push("Transamerica Field - Soccer");
                            lat.push(35.30556073286457);
                            lng.push(-80.73762479072461);
                            break;
                        case "McCoC":
                            names.push("McColl-Richardson Field - Concessions");
                            lat.push(35.31045181086794);
                            lng.push(-80.74011182694231);
                            break;
                        case "GRIG":
                            names.push("Grigg Hall");
                            lat.push(35.31125721169039);
                            lng.push(-80.74183274370174);
                            break;
                        case "Denn":
                            names.push("Denny");
                            lat.push(35.30533295968176);
                            lng.push(-80.72980795887034);
                            break;
                        case "Unio":
                            names.push("Union Deck");
                            lat.push(35.30915355927649);
                            lng.push(-80.73522839767031);
                            break;
                        case "With":
                            names.push("Witherspoon Hall");
                            lat.push(35.31091281659303);
                            lng.push(-80.73230276211463);
                            break;
                        case "Frid":
                            names.push("Friday");
                            lat.push(35.30628511732297);
                            lng.push(-80.72997554801233);
                            break;
                        case "Mart":
                            names.push("Martin Hall");
                            lat.push(35.30993975891089);
                            lng.push(-80.72745035992615);
                            break;
                        case "Macy":
                            names.push("Macy");
                            lat.push(35.305738003574184);
                            lng.push(-80.73047515456338);
                            break;
                        case "Coun":
                            names.push("Price Counseling Center");
                            lat.push(35.310251760035584);
                            lng.push(-80.73006844660692);
                            break;
                        case "Cafe":
                            names.push("Cafeteria Activities Building");
                            lat.push(35.30905807801118);
                            lng.push(-80.72819881504607);
                            break;
                        case "Ceda":
                            names.push("Cedar Hall");
                            lat.push(35.3095532);
                            lng.push(-80.7289938);
                            break;
                        case "FOPS":
                            names.push("Facilities Operations & Parking Services");
                            lat.push(35.314182346671856);
                            lng.push(-80.73272456401536);
                            break;
                        case "Laur":
                            names.push("Laurel Hall");
                            lat.push(35.302517699178985);
                            lng.push(-80.73595446556496);
                            break;
                        case "NERF":
                            names.push("Northeast Recreational Field Complex");
                            lat.push(35.31344100794077);
                            lng.push(-80.72319983871316);
                            break;
                        case "Phil":
                            names.push("D.L Phillips Complex");
                            lat.push(35.30683657536748);
                            lng.push(-80.7397596328187);
                            break;
                        case "FouA":
                            names.push("Foundation Annex");
                            lat.push(35.2981335);
                            lng.push(-80.7360096);
                            break;
                        case "McMi":
                            names.push("McMillan Greenhouse");
                            lat.push(35.3078127);
                            lng.push(-80.7297808);
                            break;
                        case "Band":
                            names.push("Johnson Band Center");
                            lat.push(35.307240);
                            lng.push(-80.729310);
                            break;
                        case "BandCor":
                            names.push("Johnson Band Center - Corridor");
                            lat.push(35.307240);
                            lng.push(-80.729310);
                            break;
                        case "FaciA":
                            names.push("Facilities Management");
                            lat.push(35.314100);
                            lng.push(-80.732600);
                            break;
                        case "Barn":
                            names.push("Barnard");
                            lat.push(35.305800);
                            lng.push(-80.730030);
                            break;
                        case "FacA":
                            names.push("Facilities Management");
                            lat.push(35.314100);
                            lng.push(-80.732600);
                            break;
                        case "BelGMain":
                            names.push("Belk Gym - Main");
                            lat.push(35.30533877292375);
                            lng.push(-80.73559950455898);
                            break;
                        case "EHS":
                            names.push("Environmental Health & Safety");
                            lat.push(35.312660);
                            lng.push(-80.730080);
                            break;
                        case "JBui":
                            names.push("Facilities Annex One - J-Building");
                            lat.push(35.312074673261264);
                            lng.push(-80.73049956290934);
                            break;
                        case "McCo":
                            names.push("McColl-Richardson Field");
                            lat.push(35.31061414580404);
                            lng.push(-80.74024765706898);
                            break;
                        case "Nine":
                            names.push("Niner House");
                            lat.push(35.30411966275528);
                            lng.push(-80.72776917094374);
                            break;
                        case "Burs":
                            names.push("Burson");
                            lat.push(35.30739649766536);
                            lng.push(-80.7323005232744);
                            break;
                        case "BelGGym":
                            names.push("Belk Gym - Gymnasium");
                            lat.push(35.30533877292375);
                            lng.push(-80.73559950455898);
                            break;
                        case "East":
                            names.push("East Deck");
                            lat.push(35.30538120328745);
                            lng.push(-80.72684464471652);
                            break;
                        case "BelGRB":
                            names.push("Belk Gym - Racquetball");
                            lat.push(35.30533877292375);
                            lng.push(-80.73559950455898);
                            break;
                        case "CRI":
                            names.push("CRI Deck");
                            lat.push(35.3092259550927);
                            lng.push(-80.74338910878436);
                            break;
                        case "BioiVEST":
                            names.push("Bioinformatics");
                            lat.push(35.3125545);
                            lng.push(-80.741512);
                            break;
                        default:
                            console.log("No building by that name.");
                    }
                }
                // set max weight (# of connections)
                let max = Math.max(...v);
            %>
            <div id="map"></div>
            <script>
               let options = {zoom: 15.15, center: new google.maps.LatLng(35.3081, -80.7343)}; // map options
                map = new google.maps.Map(document.getElementById("map"), options); // create new map
                // generate heatmap (credit to heatmap.js on github https://github.com/pa7/heatmap.js)
                heatmap = new HeatmapOverlay(map, 
                  {
                    "radius": 0.0025,
                    "maxOpacity": 0.6, 
                    "scaleRadius": true,
                    "useLocalExtrema": false,
                    latField: 'lat',
                    lngField: 'lng',
                    valueField: 'weight'
                  }
                );
                // set max 
                var max = <%- max -%>;
                // set weights (connections)
                var connections = [];
                <%
                  for (let i=0; i < v.length; i++){
                    %> connections.push(<%=v[i]%>); <%
                  }
                %>
                // set latitudes
                var latitude = [];
                <%
                  for (let i=0; i < v.length; i++){
                    %> latitude.push(<%=lat[i]%>); <%
                  }
                %>
                // set longitudes
                var longitude = [];
                <%
                  for (let i=0; i < v.length; i++){
                    %> longitude.push(<%=lng[i]%>); <%
                  }
                %>
                // generate data to be passed into setData()
                var data = [];
                for (let i =0; i < connections.length; i++){
                    let obj = {lat: latitude[i], lng: longitude[i], weight: connections[i]};
                    data.push(obj);
                }
                var wifiData = {
                  max: max,
                  data: data
                };
                heatmap.setData(wifiData); 
            </script>
            <br>
            <div>
                <table id="data">
                    <tr>
                        <th>Location</th>
                        <th>Connections</th>
                    </tr>
                    <!-- populate table with data -->
                    <% for (let i = 0; i < arr.length; i++) { %>
                        <tr>
                            <td><%= names[i]%></td>
                            <td><%= v[i]%></td>
                        </tr>
                    <% } %>
                </table>
            </div>
        </main>
        <footer>
            <p>ITSC 4155 Capstone Project - Group 15</p>
        </footer>
    </body>
</html>